<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>주식 전광판</title>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    body { font-family: sans-serif; background:#f9f9f9; }
    #ticker-board { display: flex; gap: 10px; padding: 10px; overflow-x: auto; }
    .ticker { 
      min-width: 150px; padding: 10px; border-radius: 8px; 
      background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex; flex-direction: column; align-items: center;
    }
    .symbol { font-weight: bold; }
    .price { margin: 5px 0; }
    .remove { cursor: pointer; color: red; }
  </style>
</head>
<body>

  <h2>📈 주식 전광판</h2>
  <div>
    <input id="symbolInput" placeholder="심볼 입력 (예: AAPL)">
    <button onclick="addSymbol()">추가</button>
  </div>
  <div id="ticker-board"></div>

<script>
const API_KEY = "0hJ1AvEYlcNWUkkwphe4KEA7cBcxn3Zt";
let symbols = ["AAPL", "TSLA", "MSFT"];

async function fetchQuote(symbol) {
  try {
    const url = `https://api.polygon.io/v2/last/trade/${symbol}?apiKey=${API_KEY}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error("API 요청 실패");
    const data = await res.json();
    return data.results?.p ?? null; // 가격
  } catch (e) {
    console.error(e);
    return null;
  }
}

async function renderBoard() {
  const board = document.getElementById("ticker-board");
  board.innerHTML = "";
  for (let sym of symbols) {
    const price = await fetchQuote(sym);
    const div = document.createElement("div");
    div.className = "ticker";
    div.innerHTML = `
      <div class="symbol">${sym}</div>
      <div class="price">${price ? "$" + price.toFixed(2) : "N/A"}</div>
      <div class="remove" onclick="removeSymbol('${sym}')">삭제</div>
    `;
    board.appendChild(div);
  }
}

// 심볼 추가
function addSymbol() {
  const input = document.getElementById("symbolInput");
  const sym = input.value.toUpperCase().trim();
  if (sym && !symbols.includes(sym)) {
    symbols.push(sym);
    renderBoard();
  }
  input.value = "";
}

// 심볼 삭제
function removeSymbol(sym) {
  symbols = symbols.filter(s => s !== sym);
  renderBoard();
}

// 드래그 앤 드롭
new Sortable(document.getElementById("ticker-board"), {
  animation: 150,
  onEnd: function (evt) {
    const items = document.querySelectorAll(".ticker .symbol");
    symbols = Array.from(items).map(el => el.textContent);
  }
});

// 일정 주기로 갱신 (예: 10초마다)
setInterval(renderBoard, 10000);
renderBoard();
</script>

</body>
</html>
